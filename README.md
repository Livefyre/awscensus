# awscensus
Tools to analyze and interact with our AWS fleet

### awscensus

run without args for usage message

### ec2 module

contains a bunch of utility methods for pulling together data about the fleet

#### ec2.instances.get(envs)

queries aws and returns a list of servers for the given envs. envs is a list of
of aws credentials (see ec2.config). 

the results are massaged by ec2.instances.cook which normalizes env and role
(cluster and tier) as best it can with patchy data.

#### ec2.instances.Group

useful for generating reports on groups of instances. you can group up
instances and stash them on a Group object any way you like. You can then query
attributes for the group of instances - e.g. prices.

```python
    g = ec2.instances.Group(key)
    g.instances.append(instance1)
    g.instances.append(instance2)

    # how much to buy a 1 year all upfront lease for this group
    g.price('1au')

    # how much would this group cost if we swapped the instance type?
    g.price('1au', instance_type='c3.xlarge')
```

it's nothing fancy, so add more attributes as desired!

#### ec2.metrics.refresh

call to refresh metrics.json

#### ec2.metrics.get

massages and returns a list of metrics for all servers, from the cached
metrics.json, for adhoc script reporting. particularly useful to combine
with *ec2.instances.get*.

#### ec2.ri.upgrade_paths

proposed upgrade paths for old instances.

#### ec2.specs.refresh

downloads ams ec2 specs and pricing from the jsonp amazon uses to render their
pricing pages. decodes it to json and saves it to files in the current working directory.

#### ec2.specs.get(inputs)

massages and returns a list of aws ec2 instance type specs and prices from
input files (generated by specs.refresh), for adhoc script reporting. particularly 
useful to combine with *ec2.instances.get*.
